// auto generated by kmigrator
// KMIGRATOR:0017_auto_20210608_1202:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMiBvbiAyMDIxLTA2LTA4IDEyOjAyCgppbXBvcnQgZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuZmllbGRzLmpzb25iCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMTZfdGlja2V0c3RhdHVzaGlzdG9yeXJlY29yZF9jb2xvcnMnKSwKICAgIF0KCiAgICBvcGVyYXRpb25zID0gWwogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2NvbmZpcm1waG9uZWFjdGlvbicsCiAgICAgICAgICAgIGZpZWxkcz1bCiAgICAgICAgICAgICAgICAoJ2R2JywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc2VuZGVyJywgZGphbmdvLmNvbnRyaWIucG9zdGdyZXMuZmllbGRzLmpzb25iLkpTT05GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgncGhvbmUnLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSwgdW5pcXVlPVRydWUpKSwKICAgICAgICAgICAgICAgICgndG9rZW4nLCBtb2RlbHMuVGV4dEZpZWxkKHVuaXF1ZT1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3Ntc0NvZGUnLCBtb2RlbHMuSW50ZWdlckZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzbXNDb2RlUmVxdWVzdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnc21zQ29kZUV4cGlyZXNBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdyZXRyaWVzJywgbW9kZWxzLkludGVnZXJGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnaXNQaG9uZVZlcmlmaWVkJywgbW9kZWxzLkJvb2xlYW5GaWVsZCgpKSwKICAgICAgICAgICAgICAgICgncmVxdWVzdGVkQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZCgpKSwKICAgICAgICAgICAgICAgICgnZXhwaXJlc0F0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoKSksCiAgICAgICAgICAgICAgICAoJ2NvbXBsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lkJywgbW9kZWxzLlVVSURGaWVsZChwcmltYXJ5X2tleT1UcnVlLCBzZXJpYWxpemU9RmFsc2UpKSwKICAgICAgICAgICAgICAgICgnZGVsZXRlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgZGJfaW5kZXg9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ25ld0lkJywgbW9kZWxzLlVVSURGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgb3B0aW9ucz17CiAgICAgICAgICAgICAgICAnZGJfdGFibGUnOiAnQ29uZmlybVBob25lQWN0aW9uJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQ3JlYXRlTW9kZWwoCiAgICAgICAgICAgIG5hbWU9J2NvbmZpcm1waG9uZWFjdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBmaWVsZHM9WwogICAgICAgICAgICAgICAgKCdkdicsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3NlbmRlcicsIGRqYW5nby5jb250cmliLnBvc3RncmVzLmZpZWxkcy5qc29uYi5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3Bob25lJywgbW9kZWxzLlRleHRGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgndG9rZW4nLCBtb2RlbHMuVGV4dEZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdzbXNDb2RlJywgbW9kZWxzLkludGVnZXJGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgnc21zQ29kZVJlcXVlc3RlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3Ntc0NvZGVFeHBpcmVzQXQnLCBtb2RlbHMuRGF0ZVRpbWVGaWVsZChibGFuaz1UcnVlLCBudWxsPVRydWUpKSwKICAgICAgICAgICAgICAgICgncmV0cmllcycsIG1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2lzUGhvbmVWZXJpZmllZCcsIG1vZGVscy5Cb29sZWFuRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ3JlcXVlc3RlZEF0JywgbW9kZWxzLkRhdGVUaW1lRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2V4cGlyZXNBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdjb21wbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCdpZCcsIG1vZGVscy5VVUlERmllbGQocHJpbWFyeV9rZXk9VHJ1ZSwgc2VyaWFsaXplPUZhbHNlKSksCiAgICAgICAgICAgICAgICAoJ2RlbGV0ZWRBdCcsIG1vZGVscy5EYXRlVGltZUZpZWxkKGJsYW5rPVRydWUsIG51bGw9VHJ1ZSkpLAogICAgICAgICAgICAgICAgKCduZXdJZCcsIGRqYW5nby5jb250cmliLnBvc3RncmVzLmZpZWxkcy5qc29uYi5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSksCiAgICAgICAgICAgICAgICAoJ2hpc3RvcnlfZGF0ZScsIG1vZGVscy5EYXRlVGltZUZpZWxkKCkpLAogICAgICAgICAgICAgICAgKCdoaXN0b3J5X2FjdGlvbicsIG1vZGVscy5DaGFyRmllbGQoY2hvaWNlcz1bKCdjJywgJ2MnKSwgKCd1JywgJ3UnKSwgKCdkJywgJ2QnKV0sIG1heF9sZW5ndGg9NTApKSwKICAgICAgICAgICAgICAgICgnaGlzdG9yeV9pZCcsIG1vZGVscy5VVUlERmllbGQoZGJfaW5kZXg9VHJ1ZSkpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBvcHRpb25zPXsKICAgICAgICAgICAgICAgICdkYl90YWJsZSc6ICdDb25maXJtUGhvbmVBY3Rpb25IaXN0b3J5UmVjb3JkJywKICAgICAgICAgICAgfSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2ZvcmdvdHBhc3N3b3JkYWN0aW9uJywKICAgICAgICAgICAgbmFtZT0nZHYnLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuSW50ZWdlckZpZWxkKGRlZmF1bHQ9MSksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdmb3Jnb3RwYXNzd29yZGFjdGlvbicsCiAgICAgICAgICAgIG5hbWU9J3NlbmRlcicsCiAgICAgICAgICAgIGZpZWxkPWRqYW5nby5jb250cmliLnBvc3RncmVzLmZpZWxkcy5qc29uYi5KU09ORmllbGQoZGVmYXVsdD17fSksCiAgICAgICAgICAgIHByZXNlcnZlX2RlZmF1bHQ9RmFsc2UsCiAgICAgICAgKSwKICAgICAgICBtaWdyYXRpb25zLkFkZEZpZWxkKAogICAgICAgICAgICBtb2RlbF9uYW1lPSdmb3Jnb3RwYXNzd29yZGFjdGlvbmhpc3RvcnlyZWNvcmQnLAogICAgICAgICAgICBuYW1lPSdkdicsCiAgICAgICAgICAgIGZpZWxkPW1vZGVscy5JbnRlZ2VyRmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgICAgIG1pZ3JhdGlvbnMuQWRkRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J2ZvcmdvdHBhc3N3b3JkYWN0aW9uaGlzdG9yeXJlY29yZCcsCiAgICAgICAgICAgIG5hbWU9J3NlbmRlcicsCiAgICAgICAgICAgIGZpZWxkPWRqYW5nby5jb250cmliLnBvc3RncmVzLmZpZWxkcy5qc29uYi5KU09ORmllbGQoYmxhbms9VHJ1ZSwgbnVsbD1UcnVlKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Create model confirmphoneaction
--
CREATE TABLE "ConfirmPhoneAction" ("dv" integer NOT NULL, "sender" jsonb NOT NULL, "phone" text NULL UNIQUE, "token" text NOT NULL UNIQUE, "smsCode" integer NULL, "smsCodeRequestedAt" timestamp with time zone NOT NULL, "smsCodeExpiresAt" timestamp with time zone NOT NULL, "retries" integer NOT NULL, "isPhoneVerified" boolean NOT NULL, "requestedAt" timestamp with time zone NOT NULL, "expiresAt" timestamp with time zone NOT NULL, "completedAt" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "deletedAt" timestamp with time zone NULL, "newId" uuid NULL);
--
-- Create model confirmphoneactionhistoryrecord
--
CREATE TABLE "ConfirmPhoneActionHistoryRecord" ("dv" integer NULL, "sender" jsonb NULL, "phone" text NULL, "token" text NULL, "smsCode" integer NULL, "smsCodeRequestedAt" timestamp with time zone NULL, "smsCodeExpiresAt" timestamp with time zone NULL, "retries" integer NULL, "isPhoneVerified" boolean NULL, "requestedAt" timestamp with time zone NULL, "expiresAt" timestamp with time zone NULL, "completedAt" timestamp with time zone NULL, "id" uuid NOT NULL PRIMARY KEY, "deletedAt" timestamp with time zone NULL, "newId" jsonb NULL, "history_date" timestamp with time zone NOT NULL, "history_action" varchar(50) NOT NULL, "history_id" uuid NOT NULL);
--
-- Add field dv to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" ADD COLUMN "dv" integer DEFAULT 1 NOT NULL;
ALTER TABLE "ForgotPasswordAction" ALTER COLUMN "dv" DROP DEFAULT;
--
-- Add field sender to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" ADD COLUMN "sender" jsonb DEFAULT '{"dv":1, "fingerprint":"unknown"}' NOT NULL;
ALTER TABLE "ForgotPasswordAction" ALTER COLUMN "sender" DROP DEFAULT;
--
-- Add field dv to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" ADD COLUMN "dv" integer DEFAULT 1 NOT NULL;
ALTER TABLE "ForgotPasswordActionHistoryRecord" ALTER COLUMN "dv" DROP DEFAULT;
--
-- Add field sender to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" ADD COLUMN "sender" jsonb DEFAULT '{"dv":1, "fingerprint":"unknown"}' NOT NULL;
ALTER TABLE "ForgotPasswordActionHistoryRecord" ALTER COLUMN "sender" DROP DEFAULT;

CREATE INDEX "ConfirmPhoneAction_phone_191818b3_like" ON "ConfirmPhoneAction" ("phone" text_pattern_ops);
CREATE INDEX "ConfirmPhoneAction_token_d3576799_like" ON "ConfirmPhoneAction" ("token" text_pattern_ops);
CREATE INDEX "ConfirmPhoneAction_deletedAt_fad3ac40" ON "ConfirmPhoneAction" ("deletedAt");
CREATE INDEX "ConfirmPhoneActionHistoryRecord_history_id_0089f670" ON "ConfirmPhoneActionHistoryRecord" ("history_id");
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Add field sender to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" DROP COLUMN "sender" CASCADE;
--
-- Add field dv to forgotpasswordactionhistoryrecord
--
ALTER TABLE "ForgotPasswordActionHistoryRecord" DROP COLUMN "dv" CASCADE;
--
-- Add field sender to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" DROP COLUMN "sender" CASCADE;
--
-- Add field dv to forgotpasswordaction
--
ALTER TABLE "ForgotPasswordAction" DROP COLUMN "dv" CASCADE;
--
-- Create model confirmphoneactionhistoryrecord
--
DROP TABLE "ConfirmPhoneActionHistoryRecord" CASCADE;
--
-- Create model confirmphoneaction
--
DROP TABLE "ConfirmPhoneAction" CASCADE;
COMMIT;

    `)
}
